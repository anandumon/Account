# This render.yaml is for the "Account" Spring Boot application.
# It defines the Java application service and its own dedicated PostgreSQL database.

services:
  # -----------------
  # The Account Service (Spring Boot Application)
  # -----------------
  - type: web
    name: account-service
    env: java
    # Ensure your project has the Maven wrapper (mvnw). If not, use 'mvn -Dmaven.repo.local=./.m2/repository clean install'.
    buildCommand: "./mvnw clean install"
    # This command runs the JAR file created by the build.
    # IMPORTANT: Verify 'account-0.0.1-SNAPSHOT.jar' matches the artifact name in your pom.xml.
    startCommand: "java -jar target/account-0.0.1-SNAPSHOT.jar"

    envVars:
      # --- Java Version ---
      # This tells Render to use a JDK 21 environment to build and run the application.
      - key: JAVA_VERSION
        value: 21

      # --- Spring Boot Profile ---
      # This tells the application to load 'application-prod.properties'.
      - key: SPRING_PROFILES_ACTIVE
        value: prod

      # --- Database Connection ---
      # These variables are dynamically and securely populated by Render 
      # from the 'account-db' service defined below.
      - key: DB_URL
        fromDatabase:
          name: account-db
          property: connectionString
      - key: DB_USERNAME
        fromDatabase:
          name: account-db
          property: user
      - key: DB_PASSWORD
        fromDatabase:
          name: account-db
          property: password

  # -----------------
  # The Account Database (PostgreSQL)
  # -----------------
  - type: pserv
    name: account-db
    # Choose your desired plan (free, starter, standard, etc.)
    plan: free
    # This is the actual name of the database that will be created inside PostgreSQL.
    databaseName: bank_account
    # Allows other services in your Render account (like 'account-service') to connect.
    ipAllowList: []
